<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewModels="clr-namespace:FloofLog.ViewModels"
             xmlns:models="clr-namespace:FloofLog.Models"
             xmlns:shapes="clr-namespace:Microsoft.Maui.Controls.Shapes;assembly=Microsoft.Maui.Controls"
             x:Class="FloofLog.MainPage"
             x:DataType="viewModels:MainPageViewModel"
             Title="Dashboard">

    <RefreshView Command="{Binding RefreshCommand}"
                 IsRefreshing="{Binding IsBusy}">
        <ScrollView>
            <VerticalStackLayout Padding="24"
                                  Spacing="16">
                <Label Text="Welcome back!"
                       Style="{StaticResource Headline}" />

                <Grid ColumnDefinitions="*,*,*"
                      ColumnSpacing="12"
                      RowSpacing="12">
                    <Border Stroke="{AppThemeBinding Light={StaticResource Gray200}, Dark={StaticResource Gray500}}"
                            BackgroundColor="{AppThemeBinding Light={StaticResource White}, Dark={StaticResource Gray900}}"
                            Padding="12">
                        <Border.StrokeShape>
                            <shapes:RoundRectangle CornerRadius="12" />
                        </Border.StrokeShape>
                        <VerticalStackLayout>
                            <Label Text="Total Pets"
                                   FontAttributes="Bold"
                                   FontSize="12"
                                   TextColor="{AppThemeBinding Light={StaticResource Gray500}, Dark={StaticResource Gray200}}" />
                            <Label Text="{Binding TotalPets}"
                                   FontSize="28"
                                   FontAttributes="Bold" />
                        </VerticalStackLayout>
                    </Border>
                    <Border Grid.Column="1"
                            Stroke="{AppThemeBinding Light={StaticResource Gray200}, Dark={StaticResource Gray500}}"
                            BackgroundColor="{AppThemeBinding Light={StaticResource White}, Dark={StaticResource Gray900}}"
                            Padding="12">
                        <Border.StrokeShape>
                            <shapes:RoundRectangle CornerRadius="12" />
                        </Border.StrokeShape>
                        <VerticalStackLayout>
                            <Label Text="Activities Today"
                                   FontAttributes="Bold"
                                   FontSize="12"
                                   TextColor="{AppThemeBinding Light={StaticResource Gray500}, Dark={StaticResource Gray200}}" />
                            <Label Text="{Binding ActivitiesLoggedToday}"
                                   FontSize="28"
                                   FontAttributes="Bold" />
                        </VerticalStackLayout>
                    </Border>
                    <Border Grid.Column="2"
                            Stroke="{AppThemeBinding Light={StaticResource Gray200}, Dark={StaticResource Gray500}}"
                            BackgroundColor="{AppThemeBinding Light={StaticResource White}, Dark={StaticResource Gray900}}"
                            Padding="12">
                        <Border.StrokeShape>
                            <shapes:RoundRectangle CornerRadius="12" />
                        </Border.StrokeShape>
                        <VerticalStackLayout>
                            <Label Text="Pending Reminders"
                                   FontAttributes="Bold"
                                   FontSize="12"
                                   TextColor="{AppThemeBinding Light={StaticResource Gray500}, Dark={StaticResource Gray200}}" />
                            <Label Text="{Binding PendingReminders}"
                                   FontSize="28"
                                   FontAttributes="Bold" />
                        </VerticalStackLayout>
                    </Border>
                </Grid>

                <VerticalStackLayout Spacing="8">
                    <Label Text="Log a quick activity"
                           FontAttributes="Bold"
                           FontSize="18" />
                    <Entry Placeholder="Describe the activity"
                           Text="{Binding NewActivityName}" />
                    <HorizontalStackLayout Spacing="12">
                        <Button Text="Add Activity"
                                Command="{Binding AddActivityCommand}" />
                        <Button Text="Log Feeding"
                                Command="{Binding LogFeedingCommand}" />
                    </HorizontalStackLayout>
                </VerticalStackLayout>

                <VerticalStackLayout Spacing="8">
                    <Label Text="Plan a reminder"
                           FontAttributes="Bold"
                           FontSize="18" />
                    <Entry Placeholder="Reminder title"
                           Text="{Binding NewReminderTitle}" />
                    <Button Text="Schedule Reminder"
                            Command="{Binding ScheduleReminderCommand}" />
                </VerticalStackLayout>

                <Label Text="Recent Activities"
                       Style="{StaticResource SubHeadline}" />
                <CollectionView ItemsSource="{Binding RecentActivities}"
                                HeightRequest="220">
                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="models:PetActivity">
                            <VerticalStackLayout Padding="12"
                                                 Spacing="4">
                                <Label Text="{Binding DisplayName}" FontAttributes="Bold" />
                                <Label Text="{Binding Notes}" FontSize="12" TextColor="Gray" />
                                <Label Text="{Binding OccurredAt, StringFormat='{0:G}'}" FontSize="12" />
                            </VerticalStackLayout>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>

                <Label Text="Upcoming Reminders"
                       Style="{StaticResource SubHeadline}" />
                <CollectionView ItemsSource="{Binding UpcomingReminders}"
                                HeightRequest="220">
                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="models:PetReminder">
                            <VerticalStackLayout Padding="12"
                                                 Spacing="4">
                                <Label Text="{Binding DisplayName}" FontAttributes="Bold" />
                                <Label Text="{Binding RemindAt, StringFormat='{0:G}'}" FontSize="12" />
                            </VerticalStackLayout>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>

                <Label Text="{Binding StatusMessage}"
                       FontSize="12"
                       TextColor="{AppThemeBinding Light={StaticResource Gray500}, Dark={StaticResource Gray300}}" />
            </VerticalStackLayout>
        </ScrollView>
    </RefreshView>
</ContentPage>
